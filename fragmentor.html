<!DOCTYPE html>
<html>
<head>
<title>ðŸ§© Sovereign Fragmentor v0.2</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body {
    font-family: sans-serif;
    margin: 20px;
    background: #111;
    color: #eee;
  }
  textarea, button, input {
    width: 100%;
    margin: 10px 0;
    padding: 15px;
    border-radius: 8px;
    font-size: 16px;
  }
  textarea {
    background: #222;
    color: #fff;
    border: 1px solid #444;
    height: 200px;
  }
  button {
    background: #28a;
    color: white;
    border: none;
    font-weight: bold;
  }
  .frag {
    margin: 15px 0;
    padding: 15px;
    background: #222;
    border-radius: 8px;
  }
  .stats {
    padding: 15px;
    background: #333;
    border-radius: 8px;
    margin: 15px 0;
  }
  .setting {
    display: flex;
    align-items: center;
    margin: 10px 0;
  }
  .setting label {
    width: 150px;
    margin-right: 10px;
  }
  .setting input {
    flex: 1;
    background: #222;
    color: white;
    border: 1px solid #444;
  }
  .charCount {
    color: #8af;
    font-weight: bold;
  }
</style>
</head>
<body>
<h2>ðŸ§© Sovereign Fragmentor v0.2</h2>

<div class="stats">
  <div><strong>Limit:</strong> <span class="charCount">12,825</span> characters per fragment</div>
  <div><strong>Your text:</strong> <span id="charDisplay">0</span> characters</div>
  <div><strong>Will create:</strong> <span id="fragEstimate">0</span> fragments</div>
</div>

<div class="setting">
  <label for="charLimit">Character limit:</label>
  <input type="number" id="charLimit" value="12825" min="100" max="20000">
</div>

<textarea id="input" placeholder="Paste your text here..."></textarea>

<button onclick="fragment()">ðŸ”ª SPLIT INTO FRAGMENTS</button>
<button onclick="copyAll()">ðŸ“‹ COPY ALL FRAGMENTS</button>
<button onclick="clearAll()">ðŸ§¹ CLEAR</button>

<div id="output"></div>

<script>
// Update character count in real-time
document.getElementById('input').addEventListener('input', function() {
  const chars = this.value.length;
  document.getElementById('charDisplay').textContent = chars;
  const limit = parseInt(document.getElementById('charLimit').value) || 12825;
  const frags = Math.ceil(chars / limit);
  document.getElementById('fragEstimate').textContent = frags;
});

function fragment() {
  const text = document.getElementById('input').value.trim();
  if (!text) return alert('Paste some text first!');
  
  // FIXED: Handle empty/NaN input
  const limitInput = document.getElementById('charLimit').value;
  const limit = limitInput ? parseInt(limitInput) : 12825;
  if (isNaN(limit) || limit < 100) {
    alert('Invalid limit. Using default 12,825 characters.');
    limit = 12825;
    document.getElementById('charLimit').value = limit;
  }
  
  const fragments = [];
  for (let i = 0; i < text.length; i += limit) {
    const chunk = text.slice(i, i + limit);
    const fragNum = fragments.length + 1;
    const totalFrags = Math.ceil(text.length / limit);
    
    const header = `[FRAGMENT ${fragNum}/${totalFrags}]\n`;
    const metadata = `â€¢ Characters: ${chunk.length}\nâ€¢ Next fragment: ${fragNum < totalFrags ? fragNum + 1 : 'END'}\n`;
    const separator = 'â”€'.repeat(40) + '\n';
    
    fragments.push(header + metadata + separator + chunk + '\n' + separator);
  }
  
  const out = document.getElementById('output');
  out.innerHTML = '';
  
  fragments.forEach((frag, idx) => {
    const div = document.createElement('div');
    div.className = 'frag';
    div.innerHTML = `
      <strong>Fragment ${idx + 1}/${fragments.length}</strong> 
      <span style="color:#8af;">(${frag.match(/â€¢ Characters: (\d+)/)[1]} chars)</span>
      <br><textarea rows="10">${frag.trim()}</textarea>
    `;
    out.appendChild(div);
  });
}

function copyAll() {
  const frags = document.querySelectorAll('#output textarea');
  if (frags.length === 0) return alert('No fragments to copy!');
  
  let all = '';
  frags.forEach(f => all += f.value + '\n\n');
  
  navigator.clipboard.writeText(all).then(() => {
    alert(`Copied ${frags.length} fragments to clipboard!`);
  });
}

function clearAll() {
  document.getElementById('input').value = '';
  document.getElementById('output').innerHTML = '';
  document.getElementById('charDisplay').textContent = '0';
  document.getElementById('fragEstimate').textContent = '0';
}
</script>
</body>
</html>
